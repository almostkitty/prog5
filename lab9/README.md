
## Лабораторная работа #9
#### Пальчук Г.А. ИВТ 2.1

1. [Задание](#title1)
2. [Ход работы](#title2)
3. [Инструкция по запуску сервиса и взаимодействию с проектом](#title3)


## <a id="title1">Задание</a>
### Описание задачи
Реализуйте REST-сервис для просмотра текущего уровня бонусной программы, который дает определенный кешбэк пользователю и следующего уровня ("серебряный", "золотой", "платиновый" уровень при определенном объеме трат). Поскольку эти данные являются важными и критичными, каждый пользователь может видеть только информацию о своем кэшбеке. Для обеспечения безопасности потребуется реализовать метод, который по логину и паролю сотрудника будет выдавать секретный токен, действующий в течение определенного времени. Запрос данных о бонусной программе должен выдаваться только при предъявлении валидного токена пользователем. В модели данных и в интерфейсе соответственно должны быть отображены. Уровень трат и границы бонусных уровней

### Аутентификация и авторизация
1. Реализуйте метод аутентификации, который принимает логин и пароль сотрудника и выдает JWT-токен, действующий в течение определенного времени. Используйте паттерн Фабрика для создания токенов. Это позволит вам легко изменять логику создания токенов в будущем, если потребуется.
2. Реализуйте middleware для проверки валидности токена в каждом запросе к защищенным ресурсам.

### Уровни бонусов
Реализуйте логику, которая будет автоматически обновлять уровень пользователя на основе его трат. Для этого используйте паттерн Наблюдатель: когда пользователь совершает транзакцию, он должен уведомлять систему о своих новых тратах, и система должна проверять, не изменился ли уровень пользователя.

### REST API
- POST /auth/login — аутентификация сотрудника и получение токена.
- GET /users/{id}/bonus — получение информации о текущем уровне бонусной программы и кешбэке для пользователя с указанным ID (требует токен).
- POST /users/{id}/transactions — добавление новой транзакции для пользователя (требует токен), что будет инициировать обновление уровня бонусов.

-----

## Отчёт о проделанной работе


## <a id="title2">Ход работы</a>
> ### Установлены следующие библиотеки:
> Flask==3.1.0
> Flask-JWT-Extended==4.7.1
> Flask-SQLAlchemy==3.1.1
> Flask-migrate
> PyJWT==2.10.1
> мSQLAlchemy==2.0.36
> poetry==1.8.5

Выполнена начальная настрока poetry через команду `poetry initс


> ### Структура проекта:
> app/templates -- Директория с разметкой основных страниц
> app/routes/main.py -- Файл с обработкой маршрутов
> app/__init__.py -- Файл с подключением БД, JWT-Токена и миграцией
> app/models.py -- Структура для БД
> config.py -- Файл конфигурации
> app.py -- Основной файл для запуска


## <a id="title3">Инструкция по запуску сервиса и взаимодействию с проектом</a>
1. Создание и активация виртуального окружения:
`python3 -m venv venv`
`source venv/bin/activate`

2. Установка зависимостей:
`pip install -r requirements.txt`

3. Инициализация БД:

`flask db init`
`flask db migrate -m "Инициализация базы данных"`
`flask db upgrade`

4. Запуск:
`flask --app app run`

Переходим по адресу: http://127.0.0.1:5000/

Маршруты:
1. Регистрация -- http://127.0.0.1:5000/register
2. Вход в систему -- http://127.0.0.1:5000/login 

